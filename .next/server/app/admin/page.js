(()=>{var e={};e.id=3,e.ids=[3],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8946:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>l}),a(4753),a(5996),a(5866);var r=a(3191),s=a(8716),n=a(7922),o=a.n(n),i=a(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);a.d(t,d);let l=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,4753)),"/home/user/studio/src/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,5996)),"/home/user/studio/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/user/studio/src/app/admin/page.tsx"],m="/admin/page",p={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},3125:(e,t,a)=>{Promise.resolve().then(a.bind(a,3677))},3677:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var r=a(326),s=a(7577),n=a(5047),o=a(1664),i=a(9752),d=a(3819),l=a(7525),c=a(4584),m=a(6787),p=a(5095),h=a(7506),u=a(2881);let x=(0,u.Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var f=a(1810);let g=(0,u.Z)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]),w=(0,u.Z)("download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var j=a(949);let y=(0,u.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var v=a(1223);let N=(0,u.Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),b=(0,u.Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);function _({className:e,classNames:t,showOutsideDays:a=!0,...s}){return r.jsx(Object(function(){var e=Error("Cannot find module 'react-day-picker'");throw e.code="MODULE_NOT_FOUND",e}()),{showOutsideDays:a,className:(0,v.cn)("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,v.cn)((0,o.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,v.cn)((0,o.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>r.jsx(N,{className:"h-4 w-4"}),IconRight:({...e})=>r.jsx(b,{className:"h-4 w-4"})},...s})}(function(){var e=Error("Cannot find module 'react-day-picker'");throw e.code="MODULE_NOT_FOUND",e})(),_.displayName="Calendar",function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}();let D=Object(function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}()),O=Object(function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}()),k=s.forwardRef(({className:e,align:t="center",sideOffset:a=4,...s},n)=>r.jsx(Object(function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}()),{children:r.jsx(Object(function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}()),{ref:n,align:t,sideOffset:a,className:(0,v.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));function L({className:e,date:t,onDateChange:a}){return r.jsx("div",{className:(0,v.cn)("grid gap-2",e),children:(0,r.jsxs)(D,{children:[r.jsx(O,{asChild:!0,children:(0,r.jsxs)(o.z,{id:"date",variant:"outline",className:(0,v.cn)("w-[300px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[r.jsx(y,{className:"mr-2 h-4 w-4"}),t?.from?t.to?(0,r.jsxs)(r.Fragment,{children:[Object(function(){var e=Error("Cannot find module '__barrel_optimize__?names=format!=!date-fns'");throw e.code="MODULE_NOT_FOUND",e}())(t.from,"LLL dd, y")," -"," ",Object(function(){var e=Error("Cannot find module '__barrel_optimize__?names=format!=!date-fns'");throw e.code="MODULE_NOT_FOUND",e}())(t.to,"LLL dd, y")]}):Object(function(){var e=Error("Cannot find module '__barrel_optimize__?names=format!=!date-fns'");throw e.code="MODULE_NOT_FOUND",e}())(t.from,"LLL dd, y"):r.jsx("span",{children:"Pick a date range"})]})}),r.jsx(k,{className:"w-auto p-0",align:"start",children:r.jsx(_,{initialFocus:!0,mode:"range",defaultMonth:t?.from,selected:t,onSelect:e=>{a(e)},numberOfMonths:2})})]})})}k.displayName=Object(function(){var e=Error("Cannot find module '@radix-ui/react-popover'");throw e.code="MODULE_NOT_FOUND",e}()).displayName,function(){var e=Error("Cannot find module '__barrel_optimize__?names=format!=!date-fns'");throw e.code="MODULE_NOT_FOUND",e}();var C=a(6226);let E=()=>{let e=(0,n.useRouter)(),{toast:t}=(0,c.p)(),[a,u]=(0,s.useState)([]),[y,v]=(0,s.useState)(!0),[N,b]=(0,s.useState)(!1),[_,D]=(0,s.useState)(void 0),[O,k]=(0,s.useState)(null),[E,T]=(0,s.useState)(!1);(0,s.useEffect)(()=>{T(!0)},[]),(0,s.useEffect)(()=>{if(E){let a=(0,p.He)();if(console.log("Admin page: Checked login status:",a),a&&"admin"===a.toLowerCase()){let e=new Date,t=new Date(e);t.setDate(e.getDate()-7);let a={from:t,to:e};D(a),M(a)}else t({title:"Unauthorized",description:"Redirecting to login...",variant:"destructive"}),(0,p.TX)(),e.replace("/login")}},[e,t,E]);let M=(0,s.useCallback)(async e=>{if(E){v(!0),k(null),console.log("Fetching records for range:",e);try{let t=await (0,m.zI)(e?.from,e?.to);console.log(`Fetched ${t.length} records.`);let a=t.map(e=>({...e,timestamp:e.timestamp instanceof Date?e.timestamp:new Date(e.timestamp||0),inTime:e.inTime?e.inTime instanceof Date?e.inTime:new Date(e.inTime):void 0,outTime:e.outTime?e.outTime instanceof Date?e.outTime:new Date(e.outTime):void 0,employeeId:e.employeeId??"N/A",phone:e.phone??"N/A",name:e.name??"N/A",latitude:e.latitude??0,longitude:e.longitude??0,address:e.address??"N/A",captureMethod:e.captureMethod??"unknown",shiftTiming:e.shiftTiming??"N/A",workingLocation:e.workingLocation??"N/A",photoDataUri:e.photoDataUri??""})).filter(e=>!isNaN(e.timestamp.getTime()));u(a)}catch(e){console.error("Failed to fetch attendance records:",e),k("Could not fetch attendance records. Please try again."),t({title:"Error",description:"Could not fetch attendance records.",variant:"destructive"}),u([])}finally{v(!1)}}},[t,E]),U=(0,s.useCallback)(e=>{console.log("Date range selected:",e),D(e),M(e)},[M]),S=(0,s.useCallback)(()=>{if(0===a.length){t({title:"No Data",description:"There are no records in the selected range to download.",variant:"warning"});return}b(!0);try{let e=(0,m.Kl)(a);if(!e)throw Error("CSV data generation returned empty.");let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),n=URL.createObjectURL(r);s.setAttribute("href",n);let o="attendance_report";if(_?.from)try{o+=`_${A(_.from)}`}catch{o+="_invalid-start-date"}if(_?.to)try{o+=`_to_${A(_.to)}`}catch{o+="_invalid-end-date"}else if(_?.from)try{o+=`_on_${A(_.from)}`}catch{o+="_invalid-date"}o+=".csv",s.setAttribute("download",o),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n),t({title:"Download Started",description:"Your attendance report CSV is being generated."})}catch(e){console.error("Failed to generate or download CSV:",e),t({title:"Download Error",description:`Could not generate the CSV file: ${e.message}`,variant:"destructive"})}finally{b(!1)}},[a,_,t]),A=e=>{if(!e||!(e instanceof Date)||isNaN(e.getTime()))return"invalid_date";let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`},F=(e,t)=>{if(!e)return"--";let a=e instanceof Date?e:new Date(e);if(isNaN(a.getTime()))return"Invalid";try{if("date"===t)return a.toLocaleDateString();if("time"===t)return a.toLocaleTimeString();return"--"}catch{return"Format Error"}},z=(0,s.useCallback)(()=>{(0,p.TX)(),t({title:"Logged Out",description:"You have been logged out."}),e.replace("/login")},[e,t]),P=(0,s.useMemo)(()=>a,[a]);return E?(0,r.jsxs)("div",{className:"relative flex flex-col min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 dark:from-gray-800 dark:via-gray-900 dark:to-black p-4 md:p-8 overflow-hidden",children:[r.jsx(C.default,{src:"https://picsum.photos/seed/adminbg/1920/1080",alt:"Admin background",layout:"fill",objectFit:"cover",quality:60,className:"absolute inset-0 z-0 opacity-10 dark:opacity-5"}),(0,r.jsxs)("header",{className:"relative z-10 mb-6 flex flex-col md:flex-row justify-between items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-primary",children:"Admin Dashboard"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"E Wheels and Logistics"})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap justify-center md:justify-end",children:[(0,r.jsxs)(o.z,{variant:"outline",onClick:()=>{e.push("/admin/employees")},children:[r.jsx(x,{className:"mr-2 h-4 w-4"})," Manage Employees"]}),(0,r.jsxs)(o.z,{variant:"outline",onClick:z,children:[r.jsx(f.Z,{className:"mr-2 h-4 w-4"})," Logout"]})]})]}),(0,r.jsxs)(i.Zb,{className:"relative z-10 flex-grow shadow-xl bg-card/90 backdrop-blur-sm dark:bg-card/80 border border-border/50",children:[(0,r.jsxs)(i.Ol,{children:[r.jsx(i.ll,{children:"Attendance Records"}),r.jsx(i.SZ,{children:"View, filter, and download employee attendance data."})]}),(0,r.jsxs)(i.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center p-4 bg-muted/50 rounded-lg border",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[r.jsx(g,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),r.jsx(L,{date:_,onDateChange:U})]}),(0,r.jsxs)(o.z,{onClick:S,disabled:N||y||0===P.length,className:"w-full md:w-auto flex-shrink-0",children:[N?r.jsx(h.Z,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(w,{className:"mr-2 h-4 w-4"}),N?"Downloading...":"Download CSV"]})]}),O&&(0,r.jsxs)("div",{className:"p-4 bg-destructive/10 border border-destructive/30 rounded-md flex items-center gap-3",children:[r.jsx(j.Z,{className:"h-5 w-5 text-destructive flex-shrink-0"}),r.jsx("p",{className:"text-sm text-destructive",children:O})]}),r.jsx("div",{className:"mt-4",children:y?(0,r.jsxs)("div",{className:"flex flex-col justify-center items-center h-64 text-center",children:[r.jsx(h.Z,{className:"h-12 w-12 animate-spin text-primary mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Loading records for the selected period..."})]}):r.jsx(l.x,{className:"h-[60vh] rounded-md border",children:(0,r.jsxs)(d.iA,{children:[r.jsx(d.Rn,{children:0===P.length?"No attendance records found for the selected date range.":`Showing ${P.length} records.`}),(0,r.jsxs)(d.xD,{className:"sticky top-0 bg-secondary/95 backdrop-blur-sm z-10",children:[" ",(0,r.jsxs)(d.SC,{children:[r.jsx(d.ss,{className:"whitespace-nowrap",children:"Employee ID"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Phone"}),r.jsx(d.ss,{children:"Name"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Date"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Marked Time"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"In Time"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Out Time"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Location (Lat, Lon)"}),r.jsx(d.ss,{children:"Address"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Method"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Shift"}),r.jsx(d.ss,{className:"whitespace-nowrap",children:"Work Location"}),r.jsx(d.ss,{children:"Photo"})]})]}),r.jsx(d.RM,{children:P.length>0?P.map(e=>(0,r.jsxs)(d.SC,{children:[" ",r.jsx(d.pj,{className:"whitespace-nowrap",children:e.employeeId}),r.jsx(d.pj,{className:"whitespace-nowrap",children:e.phone}),r.jsx(d.pj,{children:e.name}),r.jsx(d.pj,{className:"whitespace-nowrap",children:F(e.timestamp,"date")}),r.jsx(d.pj,{className:"whitespace-nowrap",children:F(e.timestamp,"time")}),r.jsx(d.pj,{className:"whitespace-nowrap",children:F(e.inTime,"time")}),r.jsx(d.pj,{className:"whitespace-nowrap",children:F(e.outTime,"time")}),r.jsx(d.pj,{className:"whitespace-nowrap",children:`${e.latitude?.toFixed(4)??"N/A"}, ${e.longitude?.toFixed(4)??"N/A"}`}),r.jsx(d.pj,{className:"min-w-[200px] max-w-xs truncate",title:e.address,children:e.address}),r.jsx(d.pj,{className:"whitespace-nowrap",children:e.captureMethod}),r.jsx(d.pj,{className:"whitespace-nowrap",children:e.shiftTiming}),r.jsx(d.pj,{className:"whitespace-nowrap",children:e.workingLocation}),r.jsx(d.pj,{children:e.photoDataUri?r.jsx("a",{href:e.photoDataUri,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm",title:"View captured photo",children:"View"}):r.jsx("span",{className:"text-muted-foreground text-sm",children:"N/A"})})]},e.id||e.timestamp.toISOString()+Math.random())):r.jsx(d.SC,{children:r.jsx(d.pj,{colSpan:13,className:"h-24 text-center text-muted-foreground",children:"No records found for the selected criteria. Adjust the date filter or add employees."})})})]})})})]})]})]}):r.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-200",children:r.jsx(h.Z,{className:"h-16 w-16 animate-spin text-primary"})})}},4753:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(8570).createProxy)(String.raw`/home/user/studio/src/app/admin/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[332,939,880,453],()=>a(8946));module.exports=r})();